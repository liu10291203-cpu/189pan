name: å¤©ç¿¼äº‘ç›˜ç­¾åˆ°

on:
  workflow_dispatch:
  schedule:
    - cron: "30 1 * * *"
    - cron: "30 12 * * *"

jobs:
  checkin:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run check-in script
        id: checkin
        env:
          TYYP_USERNAME: ${{ secrets.TYYP_USERNAME }}
          TYYP_PSW: ${{ secrets.TYYP_PSW }}
        run: |
          echo "å¼€å§‹å¤©ç¿¼äº‘ç›˜ç­¾åˆ°..."
          python main.py > index.md
          echo "ç­¾åˆ°å®Œæˆï¼Œç»“æœå·²å†™å…¥ index.md"

      # æ–°å¢æ­¥éª¤ï¼šè¯»å– index.md çš„å†…å®¹å†™å…¥ç¯å¢ƒå˜é‡ DESP
      - name: Load check-in details for notification
        run: |
          echo 'DESP<<EOF' >> $GITHUB_ENV
          cat index.md >> $GITHUB_ENV
          echo 'EOF' >> $GITHUB_ENV

      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ¤– è‡ªåŠ¨ç­¾åˆ°æ›´æ–°"
          file_pattern: "index.md"
          skip_dirty_check: true

      # PushPlus æ¨é€ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡ DESP ä½œä¸ºæ¶ˆæ¯å†…å®¹
      - name: Push notification (PushPlus)
        if: always()
        uses: dext7r/pushNotifications@v1.0.3
        with:
          TYPE: PushPlus
          TITLE: "å¤©ç¿¼äº‘ç›˜ç­¾åˆ°ç»“æœ"
          DESP: ${{ env.DESP }}
          PUSH_PLUS_TOKEN: ${{ secrets.PUSH_PLUS_TOKEN }}