name: å¤©ç¿¼äº‘ç›˜ç­¾åˆ°

on:
  # æ‰‹åŠ¨è¿è¡Œ
  workflow_dispatch:
  # å®šæ—¶è¿è¡Œï¼šUTC 1:30 = åŒ—äº¬æ—¶é—´ 09:30ï¼Œæ¯å¤©ä¸€æ¬¡
  schedule:
    - cron: "30 1 * * *"

jobs:
  checkin:
    runs-on: ubuntu-latest

    steps:
      # 1. æ‹‰å–ä»“åº“ä»£ç 
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. å®‰è£… Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 3. å®‰è£…ä¾èµ–
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. è¿è¡Œç­¾åˆ°è„šæœ¬ï¼Œè¾“å‡ºåˆ° index.md
      - name: Run check-in script
        id: checkin
        env:
          TYYP_USERNAME: ${{ secrets.TYYP_USERNAME }}
          TYYP_PSW: ${{ secrets.TYYP_PSW }}
        run: |
          echo "å¼€å§‹å¤©ç¿¼äº‘ç›˜ç­¾åˆ°..."
          python main.py > index.md
          echo "ç­¾åˆ°å®Œæˆï¼Œç»“æœå·²å†™å…¥ index.md"

      # 5. æäº¤ index.md
      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ¤– è‡ªåŠ¨ç­¾åˆ°æ›´æ–°"
          file_pattern: "index.md"
          skip_dirty_check: true

      # 6. PushPlus æ¨é€æé†’
      - name: Push notification (PushPlus)
        if: always()
        uses: dext7r/pushNotifications@v1.0.3
        with:
          TYPE: PushPlus
          TITLE: "å¤©ç¿¼äº‘ç›˜ç­¾åˆ°ç»“æœ"
          DESP: |
            æœ¬æ¬¡ç­¾åˆ°çŠ¶æ€ï¼š${{ job.status }}
            è§¦å‘æ–¹å¼ï¼š${{ github.event_name }}ï¼ˆworkflow_dispatch=æ‰‹åŠ¨ï¼Œschedule=å®šæ—¶ï¼‰
            è¿è¡Œåˆ†æ”¯ï¼š${{ github.ref_name }}
            ä»“åº“ï¼š${{ github.repository }}

            è¿è¡Œæ—¥å¿—åœ°å€ï¼š
            https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}

            è¯¦ç»†ç­¾åˆ°ä¿¡æ¯ä¼šå†™å…¥æœ¬ä»“åº“æ ¹ç›®å½•ä¸‹çš„ index.md æ–‡ä»¶ï¼Œå¯åœ¨ GitHub ä¸ŠæŸ¥çœ‹ã€‚
          PUSH_PLUS_TOKEN: ${{ secrets.PUSH_PLUS_TOKEN }}
